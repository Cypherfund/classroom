<app-navbar></app-navbar>

<ng-container *ngIf="{
  processing: (processing$ | async),
  paymentMethods: (paymentMethods$ | async),
  courseSelected: (selectedCourses$ | async),
  total: (total$ | async)
} as observables">

<p-progressBar *ngIf="observables.processing" mode="indeterminate" [style]="{'height': '6px'}" />
  <p-messages
    [enableService]="true"
    [closable]="false" />
  <div class="d-flex flex-wrap justify-content-center gap-lg-5 container my-5">
    <div class="max-w-full">
      <h2>Checkout</h2>
      <div class="mb-3">
        <label class="form-label">{{ selectedProvider.strProviderName }}</label>
        <div class='payments'>
          <img  class="me-2 provider-logo"
                [class.active]="selectedProvider.strProviderName === provider.strProviderName"
                [ngClass]="provider.strProviderName | removespaces | lowercase"
                *ngFor="let provider of observables.paymentMethods"
                [src]="imagebucket + provider.strImageUrl"
                [alt]="provider.strProviderName"
                (click)="selectedProvider = provider">
        </div>
      </div>
      <div [ngSwitch]="selectedProvider?.strDriverClassName">
        <div *ngSwitchCase="'MonetbilPaymentIntegrator'">
          <app-mobile-payment-form (processPayment)="makePayment($event)" [paymentMethod]="selectedProvider"></app-mobile-payment-form>
        </div>
        <div *ngSwitchCase="'Coinbase'">
          <app-crypto-payment-form (processPayment)="makePayment($event)"></app-crypto-payment-form>
        </div>

        <div *ngSwitchCase="'AUTHORIZE'">
          <app-card-payment-form (processPayment)="makePayment($event)"></app-card-payment-form>
        </div>

        <div *ngSwitchCase="'PAYPAL'">
          <app-paypal-payment-form (processPayment)="makePayment($event)"></app-paypal-payment-form>
        </div>

        <div *ngSwitchDefault>
        </div>
      </div>
    </div>

    <div class="max-w-full summary mt-4 mt-lg-0">
      <h2  class='mb-2 text-align-start'>Summary</h2>
      <div class="card mb-3"  *ngFor="let course of observables?.courseSelected">
        <div class='d-flex gap-2'>
          <img [src]="imagebucket + courseImage "  class="img-fluid rounded-start" alt="Product Image">
          <div class='d-flex align-items-start flex-column'>
            <p class="text-align-start mb-0 mt-0">{{course.name}}</p>
            <p class="card-text"><span>By</span><b>{{course?.instructor?.name}}</b></p>
            <b class="card-text mb-0">${{course.price}}</b>
          </div>
        </div>
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><div class='d-flex justify-content-between'><p>Subtotal</p> <p>${{observables?.total}}</p></div></li>
        <li class="list-group-item"><div class='d-flex justify-content-between'><p>Coupon Discount</p> <p>$0.00</p></div></li>
        <li class="list-group-item"><div class='d-flex justify-content-between'><p>Tax</p> <p>$0.00</p></div></li>
        <li class="list-group-item"><div class='d-flex justify-content-between'><b>Total</b> <p>${{observables?.total}}</p></div></li>
      </ul>
    </div>
  </div>
</ng-container>
<footer>
  <app-footer></app-footer>
</footer>
